import { PageLayout } from '../src/components/PageLayout';
import { ExampleLoader } from '../src/components/ExampleLoader';

<PageLayout title="Clone the repository">

<PageLayout title="Installation" description="Detailed installation guide for DyGram and Machine DSL">

## Installation Guide

Complete instructions for installing and setting up DyGram.

---

## Prerequisites

Before installing DyGram, ensure you have:

- **Node.js** 16.0 or higher
- **npm** 7.0 or higher (comes with Node.js)
- **Git** (optional, for cloning repository)

### Check Your Versions

```bash
node --version    # Should be v16.0.0 or higher
npm --version     # Should be 7.0.0 or higher
```

If you need to install or update Node.js, visit [nodejs.org](https://nodejs.org/).

---

## Installation Methods

### Method 1: NPM Install (Recommended)

Clone the repository and install dependencies:

```bash
git clone https://github.com/christopherdebeer/machine.git
cd machine

npm install
```

### Method 2: Direct Download

Download the latest release:

1. Visit [GitHub Releases](https://github.com/christopherdebeer/machine/releases)
2. Download the latest release archive
3. Extract to your desired location
4. Run `npm install` in the extracted directory

---

## Development Setup

### Start Development Server

Run the development server for the static site and playgrounds:

```bash
npm run dev
```

This will start Vite on `http://localhost:5173`.

### Build for Production

Build the static site:

```bash
npm run build
```

Output will be in the `dist` directory.

### Run Tests

Execute the test suite:

```bash
npm test
```

---

## CLI Installation

### Use with NPX (No Installation)

Execute Machine files directly with npx:

```bash
npx dygram your-file.dygram
```

### Global Installation

Install the CLI globally for easier access:

```bash
npm install -g .
```

Then use anywhere:

```bash
dygram your-file.dygram
```

### Local Installation

When installed locally, use via npm scripts or npx:

```bash
npx dygram your-file.dygram

npm run cli -- your-file.dygram
```

---

## VS Code Extension

### Installation

1. Open VS Code
2. Press `Ctrl+Shift+X` (or `Cmd+Shift+X` on Mac) to open Extensions
3. Search for "Machine" or "DyGram"
4. Click **Install**

### Manual Installation

If the extension isn't in the marketplace:

1. Navigate to the extension directory: `vscode-extension/`
2. Run: `npm install && npm run package`
3. Install the generated `.vsix` file:
   - Open VS Code
   - Press `Ctrl+Shift+P` (or `Cmd+Shift+P`)
   - Type "Install from VSIX"
   - Select the generated file

### Extension Features

Once installed, you get:
- Syntax highlighting for `.dygram` and `.mach` files
- IntelliSense (auto-completion)
- Real-time validation and diagnostics
- Go-to-definition
- Hover information

---

## Platform-Specific Instructions

### macOS

#### Using Homebrew (if Node.js not installed)

```bash
brew install node

git clone https://github.com/christopherdebeer/machine.git
cd machine
npm install
```

#### M1/M2 Macs

No special configuration needed. Node.js runs natively on Apple Silicon.

### Linux

#### Ubuntu/Debian

```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

git clone https://github.com/christopherdebeer/machine.git
cd machine
npm install
```

#### Fedora/RHEL

```bash
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo dnf install -y nodejs

git clone https://github.com/christopherdebeer/machine.git
cd machine
npm install
```

### Windows

#### Using Installer

1. Download Node.js installer from [nodejs.org](https://nodejs.org/)
2. Run installer and follow prompts
3. Open Command Prompt or PowerShell
4. Clone and install:

```powershell
git clone https://github.com/christopherdebeer/machine.git
cd machine
npm install
```

#### Using Windows Subsystem for Linux (WSL)

Follow the Linux instructions within your WSL environment.

---

## Verifying Installation

### Test CLI

```bash
npx dygram validate examples/basic/simple-state.dygram

npx dygram examples/basic/simple-state.dygram

npx dygram export --format mermaid examples/basic/simple-state.dygram
```

### Test VS Code Extension

1. Create a new file: `test.dygram`
2. Start typing:
   ```machine
   machine "Test"

   state start;
   ```
3. Verify syntax highlighting appears
4. Check for IntelliSense suggestions

### Test Development Server

```bash
npm run dev
```

Visit `http://localhost:5173` - you should see the DyGram homepage.

---

## Configuration

### TypeScript

DyGram is written in TypeScript. The `tsconfig.json` is pre-configured, but you can customize:

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "strict": true
    // ... other options
  }
}
```

### Vite

Configure the build tool in `vite.config.ts`:

```typescript
export default defineConfig({
  base: '/machine/',
  build: {
    target: 'esnext',
    // ... other options
  }
});
```

### Langium

Language configuration in `langium-config.json`:

```json
{
  "projectName": "machine-lang",
  "languages": [{
    "id": "machine",
    "extensions": [".dygram", ".mach"]
  }]
}
```

---

## Troubleshooting Installation

### Permission Errors

**macOS/Linux**:
```bash
sudo chown -R $(whoami) ~/.npm
```

**Windows**: Run Command Prompt or PowerShell as Administrator

### Port Already in Use

If port 5173 is in use, Vite will try the next available port. Or specify a port:

```bash
npm run dev -- --port 3000
```

### Dependency Installation Fails

```bash
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
```

### VS Code Extension Not Working

1. Reload VS Code: `Ctrl+Shift+P` → "Reload Window"
2. Check extension is enabled
3. Verify file extension is `.dygram` or `.mach`
4. Check Output panel for errors: View → Output → Select "Machine Language Server"

---

## Updating DyGram

### Update from Git

```bash
cd machine
git pull origin main
npm install  # Install any new dependencies
```

### Update Dependencies

```bash
npm update
```

### Check for Breaking Changes

Before updating, check:
- [Release notes](https://github.com/christopherdebeer/machine/releases)
- [Changelog](https://github.com/christopherdebeer/machine/blob/main/CHANGELOG.md)
- [Migration guides](https://github.com/christopherdebeer/machine/discussions)

---

## Uninstallation

### Remove Local Installation

```bash
cd machine
rm -rf node_modules
cd ..
rm -rf machine
```

### Remove Global CLI

```bash
npm uninstall -g machine-lang
```

### Remove VS Code Extension

1. Open VS Code Extensions (`Ctrl+Shift+X`)
2. Find the Machine extension
3. Click **Uninstall**

---

## Next Steps

Now that you have DyGram installed:

1. **Learn the basics**: [Quick Start Guide](quick-start.html)
2. **Explore examples**: [Examples Index](examples-index.html)
3. **Read the docs**: [Language Overview](language-overview.html)
4. **Try the playground**: [Mobile Playground](playground-mobile.html)

Need help? Check the [Support page](support.html).


</PageLayout>