import { PageLayout } from '../src/components/PageLayout';

export default function ApiPage() {
    return <PageLayout title="API Reference">
        <ApiContent />
    </PageLayout>;
}

export function ApiContent() {
    return (
        <>
            <section>
                <div className="container">
                    <h2 className="section-title">Programmatic API</h2>
                    <p style={{fontSize: '1.2rem', marginBottom: '3rem'}}>
                        Use DyGram as a library in your Node.js applications.
                    </p>

                    <div className="feature" style={{marginBottom: '3rem'}}>
                        <h3 className="feature-title">INSTALLATION</h3>
                        <div className="code-block" style={{marginTop: '1rem'}}>
                            <pre style={{background: 'var(--code-bg)', color: 'var(--light)', padding: '1.5rem', overflowX: 'auto', borderRadius: '4px'}}>npm install dygram</pre>
                        </div>
                    </div>

                    <div className="feature" style={{marginBottom: '3rem'}}>
                        <h3 className="feature-title">PARSING</h3>
                        <p>Parse DyGram source code into an Abstract Syntax Tree (AST):</p>
                        <div className="code-block" style={{marginTop: '1rem'}}>
                            <pre style={{background: 'var(--code-bg)', color: 'var(--light)', padding: '1.5rem', overflowX: 'auto', borderRadius: '4px', fontSize: '0.95rem'}}>{`import { createMachineServices } from 'dygram';
import { EmptyFileSystem } from 'langium';

const services = createMachineServices(EmptyFileSystem);
const parser = services.Machine.parser.LangiumParser;

const code = \`machine "Example"
  state a;
  state b;
  a -> b;\`;

const result = parser.parse(code);

if (result.lexerErrors.length === 0 &&
    result.parserErrors.length === 0) {
  console.log('Parsed successfully!');
  console.log(result.value);
}`}</pre>
                        </div>
                    </div>

                    <div className="feature" style={{marginBottom: '3rem'}}>
                        <h3 className="feature-title">CONTEXT MANAGEMENT</h3>
                        <p>Execute machines with enhanced context value management:</p>
                        <div className="code-block" style={{marginTop: '1rem'}}>
                            <pre style={{background: 'var(--code-bg)', color: 'var(--light)', padding: '1.5rem', overflowX: 'auto', borderRadius: '4px', fontSize: '0.95rem'}}>{`import { MachineExecutor } from 'dygram';

const machineData = {
  title: "Context Demo",
  nodes: [
    { name: "start", type: "state" },
    { name: "process", type: "Task", attributes: [
      { name: "meta", value: "true" },
      { name: "prompt", value: "Generate data and store using set_context_value" }
    ]},
    { name: "output", type: "context", attributes: [
      { name: "result", type: "string", value: "" }
    ]}
  ],
  edges: [
    { source: "start", target: "process" },
    { source: "process", target: "output" }
  ]
};

const config = {
  llm: {
    provider: 'anthropic',
    apiKey: process.env.ANTHROPIC_API_KEY,
    model: 'claude-3-5-sonnet-20241022'
  }
};

const executor = await MachineExecutor.create(machineData, config);
const result = await executor.execute();`}</pre>
                        </div>
                    </div>

                    <div className="feature" style={{marginBottom: '3rem'}}>
                        <h3 className="feature-title">VALIDATION</h3>
                        <p>Validate DyGram code and get diagnostic messages:</p>
                        <div className="code-block" style={{marginTop: '1rem'}}>
                            <pre style={{background: 'var(--code-bg)', color: 'var(--light)', padding: '1.5rem', overflowX: 'auto', borderRadius: '4px', fontSize: '0.95rem'}}>{`import { createMachineServices } from 'dygram';
import { EmptyFileSystem } from 'langium';

const services = createMachineServices(EmptyFileSystem);
const validator = services.Machine.validation.DocumentValidator;

// Parse and validate
const document = await services.shared.workspace
  .LangiumDocuments.getOrCreateDocument(uri, code);

const diagnostics = await validator.validateDocument(document);

diagnostics.forEach(diag => {
  console.log(\`\${diag.severity}: \${diag.message}\`);
});`}</pre>
                        </div>
                    </div>

                    <div className="feature" style={{marginBottom: '3rem'}}>
                        <h3 className="feature-title">DIAGRAM GENERATION</h3>
                        <p>Generate Mermaid diagrams from DyGram code:</p>
                        <div className="code-block" style={{marginTop: '1rem'}}>
                            <pre style={{background: 'var(--code-bg)', color: 'var(--light)', padding: '1.5rem', overflowX: 'auto', borderRadius: '4px', fontSize: '0.95rem'}}>{`import { generateMermaid } from 'dygram/cli';

const code = \`machine "Flow"
  state start;
  state end;
  start -> end;\`;

const mermaid = generateMermaid(code);
console.log(mermaid);

// Output:
// graph TD
//   start --> end`}</pre>
                        </div>
                    </div>

                    <div style={{marginTop: '4rem'}}>
                        <h2 className="section-title" style={{fontSize: '2rem'}}>CLI Commands</h2>
                        <p style={{fontSize: '1.2rem', marginBottom: '2rem'}}>
                            DyGram provides a command-line interface:
                        </p>

                        <div className="feature-grid">
                            <div className="feature">
                                <h3 className="feature-title">EXECUTE</h3>
                                <div className="code-block">
                                    <pre style={{background: 'var(--code-bg)', color: 'var(--light)', padding: '1rem', overflowX: 'auto', borderRadius: '4px', fontSize: '0.9rem'}}>npx dygram file.mach</pre>
                                </div>
                                <p style={{marginTop: '0.5rem'}}>Execute a DyGram file</p>
                            </div>

                            <div className="feature">
                                <h3 className="feature-title">VALIDATE</h3>
                                <div className="code-block">
                                    <pre style={{background: 'var(--code-bg)', color: 'var(--light)', padding: '1rem', overflowX: 'auto', borderRadius: '4px', fontSize: '0.9rem'}}>npx dygram validate file.mach</pre>
                                </div>
                                <p style={{marginTop: '0.5rem'}}>Check syntax and semantics</p>
                            </div>

                            <div className="feature">
                                <h3 className="feature-title">EXPORT</h3>
                                <div className="code-block">
                                    <pre style={{background: 'var(--code-bg)', color: 'var(--light)', padding: '1rem', overflowX: 'auto', borderRadius: '4px', fontSize: '0.9rem'}}>npx dygram export --format mermaid file.mach</pre>
                                </div>
                                <p style={{marginTop: '0.5rem'}}>Generate diagrams and documentation</p>
                            </div>
                        </div>
                    </div>

                    <div style={{marginTop: '4rem'}}>
                        <h2 className="section-title" style={{fontSize: '2rem'}}>TypeScript Support</h2>
                        <p style={{fontSize: '1.2rem', marginBottom: '1rem'}}>
                            DyGram is written in TypeScript and provides full type definitions for all APIs.
                        </p>
                        <p style={{fontSize: '1.2rem'}}>
                            See the <a href="https://github.com/christopherdebeer/machine" style={{color: 'var(--accent)', textDecoration: 'none'}}>GitHub repository</a> for detailed type information and source code.
                        </p>
                    </div>
                </div>
            </section>
        </>
    );
}
