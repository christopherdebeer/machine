import { PageLayout } from '../src/components/PageLayout';
import { ExampleLoader } from '../src/components/ExampleLoader';

<PageLayout title="Validation Features Examples">


This directory contains examples demonstrating DyGram's comprehensive validation system, including type checking, graph validation, and semantic validation.

## Examples

### `type-checking.dygram`
Type checking and type validation:
- Primitive type validation (string, number, boolean)
- Collection type validation (arrays)
- Generic type validation (Promise<T>, Array<T>)
- Optional type validation (string?)
- Type inference from values
- Template variable type checking
- Type mismatch detection

### `graph-validation.dygram`
Graph structure validation:
- Unreachable node detection
- Cycle detection in workflows
- Entry/exit point validation
- Orphaned node detection
- Graph statistics (node counts, edge counts)
- Connected components analysis
- Max nesting depth validation

### `semantic-validation.dygram`
Semantic validation of DyGram patterns:
- Init node validation (must have outgoing edges)
- Context node validation (shouldn't have incoming edges)
- Relationship semantics (inheritance between compatible types)
- Annotation compatibility (@Async on tasks only)
- @Singleton validation (tasks and contexts only)
- @Abstract validation (not on init nodes)
- Best practice enforcement

### `complete-validated.dygram`
Complete example with all validation features:
- Type-checked attributes
- Valid graph structure
- Semantic correctness
- Proper annotations
- Well-formed relationships
- Documentation notes
- Real-world e-commerce example

## Validation Types

### 1. Type Checking

Validates attribute types and catches type errors:

#### Primitive Types

<ExampleLoader path="examples/generated/example-1.dygram" height="400px" />


#### Collection Types

<ExampleLoader path="examples/generated/example-2.dygram" height="400px" />


#### Optional Types

<ExampleLoader path="examples/generated/example-3.dygram" height="400px" />


#### Type Inference

<ExampleLoader path="examples/generated/example-4.dygram" height="400px" />


### 2. Graph Validation

Ensures structural integrity:

#### Unreachable Nodes

<ExampleLoader path="examples/generated/example-5.dygram" height="400px" />


#### Cycle Detection

<ExampleLoader path="examples/generated/example-6.dygram" height="400px" />


#### Entry Point Validation

<ExampleLoader path="examples/generated/example-7.dygram" height="400px" />


#### Orphaned Nodes

<ExampleLoader path="examples/generated/example-8.dygram" height="400px" />


### 3. Semantic Validation

Enforces design patterns and best practices:

#### Init Node Rules

<ExampleLoader path="examples/generated/example-9.dygram" height="400px" />


**Valid:**

<ExampleLoader path="examples/generated/example-10.dygram" height="400px" />


#### Context Node Rules

<ExampleLoader path="examples/generated/example-11.dygram" height="400px" />


**Valid:**

<ExampleLoader path="examples/generated/example-12.dygram" height="400px" />


#### Annotation Validation

<ExampleLoader path="examples/generated/example-13.dygram" height="400px" />


**Valid:**

<ExampleLoader path="examples/generated/example-14.dygram" height="400px" />


## Validation Levels

| Level | Meaning | Action |
|-------|---------|--------|
| **Error** | Structural problem or type mismatch | Must fix |
| **Warning** | Potential issue or design smell | Should review |
| **Info** | Interesting fact or statistic | FYI |

## Validation Messages

### Type Errors
- `Type mismatch: expected number, got string`
- `Context reference "config.missing" is undefined`
- `Cannot assign null to non-optional type`

### Graph Errors
- `Unreachable node: orphan (no path from init)`
- `Cycle detected: a → b → c → a`
- `No init node defined`
- `Orphaned node: isolated (no edges)`

### Semantic Errors
- `Init node must have outgoing edges`
- `Context node should not have incoming edges`
- `@Async annotation only valid on task nodes`
- `@Singleton annotation not valid on init nodes`
- `Init nodes cannot be abstract`

## Graph Statistics

The validator provides useful metrics:

- **Node Counts** by type (task, state, init, context)
- **Edge Counts** by relationship type
- **Max Nesting Depth**
- **Connected Components** count
- **Cyclic Complexity**

## Best Practices

1. **Always Define Init Node**: Every machine should have an entry point
2. **Avoid Unreachable Nodes**: Ensure all nodes are reachable from init
3. **Use Context Correctly**: Contexts for configuration, not execution flow
4. **Type Your Attributes**: Always specify types for better validation
5. **Document Intentional Cycles**: Use notes to explain loops and retries
6. **Follow Annotation Rules**: Apply annotations only where valid
7. **Review Warnings**: Address warnings to improve code quality

## Usage

### Validate a File
```bash
npx dygram parseAndValidate examples/validation/type-checking.dygram
```

### Generate with Validation
```bash
npx dygram generate examples/validation/complete-validated.dygram -f json,html
```

### Run Tests
```bash
npm test -- --grep validation
```

## See Also

- [Advanced Features](../../docs/advanced-features.md) - Validation documentation
- [Validation Error Handling](../../docs/VALIDATION_ERROR_HANDLING.md) - Error reference
- [Testing Approach](../../docs/testing-approach.md) - Validation methodology
- [Syntax Guide](../../docs/syntax-guide.md) - Language syntax


</PageLayout>